Name: ChaliceBuildAndDeploy
SchemaVersion: "1.0"

Triggers:
  - Type: Push
    Branches:
      - main

Actions:
  Build:
    Identifier: aws/build@v1
    Inputs:
      Sources:
        - WorkflowSource
    Compute:
      Type: EC2
    Configuration:
      Steps:
        - Run: |
            sudo yum update -y
            sudo yum groupinstall \"Development Tools\" -y
            sudo yum install gcc openssl-devel bzip2-devel libffi-devel zlib-devel wget tar gzip make -y --skip-broken

            cd /usr/src
            wget https://www.python.org/ftp/python/3.12.4/Python-3.12.4.tar.xz
            tar -xf Python-3.12.4.tar.xz
            cd Python-3.12.4

            ./configure --enable-optimizations
            make -j$(nproc)
            sudo make install

            python3.12 -m pip install --upgrade pip
            python3.12 -m pip install -r requirements.txt chalice bandit flake8 pytest coverage pytest-cov

            bandit -r .
            flake8 .
            pytest --cov=.
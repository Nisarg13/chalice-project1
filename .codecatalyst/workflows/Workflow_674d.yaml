Name: ChaliceBuildAndDeploy
SchemaVersion: "1.0"

Triggers:
  - Type: Push
    Branches:
      - main

Actions:
  Build:
    Identifier: aws/build@v1
    Inputs:
      Sources:
        - WorkflowSource
    Compute:
      Type: EC2
    Configuration:
      Steps:
        - Run: |
            echo "Installing dependencies..."
            pip install --upgrade pip
            pip install -r requirements.txt
            pip install chalice bandit flake8 pytest coverage pytest-cov

            echo "Setting AWS region..."
            export AWS_DEFAULT_REGION=us-east-1  # or your preferred region

            echo "Running security and lint checks..."
            bandit -r .
            flake8 .

            echo "Running tests..."
            pytest --cov=.

            echo "Packaging Chalice App..."
            chalice package out --region us-east-2

 